(()=>{"use strict";class e{constructor(e,t=null){this.modalSelector=e,this.triggerSelector=t,this.initModal()}initModal(){const e=this.getModal(),t=this.triggerSelector?document.querySelectorAll(this.triggerSelector):null;return!!e&&(t&&t.forEach((e=>{e.addEventListener("click",(()=>this.openModal()))})),e.addEventListener("click",(t=>{t.target!=e&&""!=t.target.getAttribute("data-close")||this.closeModal(e)})),document.addEventListener("keydown",(t=>{"Escape"===t.code&&e.classList.contains("show")&&this.closeModal(e)})),!0)}openModal(){const e=this.getModal();e.classList.remove("hide"),e.classList.add("show"),document.body.style.overflow="hidden"}closeModal(){const e=this.getModal();e.classList.add("hide"),e.classList.remove("show"),document.body.style.overflow=""}getModal(){return document.querySelector(this.modalSelector)}}class t{constructor(e){this.form=e}showError(e,s){const r=this.form.querySelector(`[name=${e}]`),o=t.getErrorBox(r);r.classList.add("form-control__error"),o.innerHTML=s,o.classList.remove("hide")}cleanError(e){const s=t.getErrorBox(e);e.classList.remove("form-control__error"),s.classList.add("hide"),s.innerHTML=""}static getErrorBox(e){return e.previousElementSibling.querySelector(".modal__error-message")}}class s{constructor(e=null){this.modalInstance=e}showSuccessMessage(){(class{static renderModal(e,t){const s=document.createElement("div");return s.classList.add("modal"),s.classList.add("hide"),s.id=t,s.innerHTML=`\n                <div class="modal__dialog">\n                    <div data-close="" class="modal__close">×</div>\n                    ${e}\n                </div>\n        `,document.querySelector("body").appendChild(s),s}}).renderModal('<div class="modal__feedback-title">Your message successfully sent</div>',"modalSuccess");const t=new e("#modalSuccess");this.modalInstance.closeModal(),t.openModal()}}class r{static patternName=/^[а-яёА-ЯЁa-zA-Z\s]+$/;static patternMail=/^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z])+$/;static errorMessages=["Name cannot be empty","Email cannot be empty","Incorrect Email","Message cannot be empty"];constructor(e){this.form=e}validForm(e,t){let s="";const o={name:()=>{0!=e.get("name").length&&r.patternName.test(e.get("username"))||(s=r.errorMessages[0])},email:()=>{0==e.get("email").length?s=r.errorMessages[1]:r.patternMail.test(e.get("email"))||(s=r.errorMessages[2])},message:()=>{0==e.get("message").length&&(s=r.errorMessages[3])}};return o[t]?(o[t](),s):""}}class o{constructor(e,o=null){this.form=e,this.fields=this.form.querySelectorAll(".form-control"),this.btn=this.form.querySelector("[type=submit]"),this.isError=!1,this.url="https://jsonplaceholder.typicode.com/posts",this.errors=new t(e),this.validation=new r(e),this.messages=new s(o),this.registerEventsHandler()}registerEventsHandler(){this.btn.addEventListener("click",this.submitForm.bind(this)),this.form.addEventListener("focus",(()=>{const e=document.activeElement;e!==this.btn&&(this.errors.cleanError(e),this.isError=!1)}),!0)}async submitForm(e){e.preventDefault();const t=new FormData(this.form);let s;for(let e of t.keys())s=this.validation.validForm(t,e),0!=s.length&&(this.isError=!0,this.errors.showError(e,s));if(this.isError)return;const r=Object.fromEntries(t.entries());(await class{static request(e,t,s=null,r=null){return new Promise((o=>{const a=r?{body:JSON.stringify(r)}:{},n=(new Date).getTime();fetch(e,{method:t.toUpperCase(),headers:{"Content-type":"application/json",...s},...a}).then((e=>{if(e.status>=200&&e.status<300)return e.json();{const t=new Error(res?.statusText??"Неизвестная ошибка");throw t.response=e,t}})).then((e=>o({success:!0,data:e,time:((new Date).getTime()-n)/1e3}))).catch((e=>o({success:!1,error:{message:e?.message??"Неизвестная ошибка",status:e.response?.status??520},time:((new Date).getTime()-n)/1e3})))}))}}.request(this.url,"POST",{},r)).success&&(this.messages.showSuccessMessage(),this.form.reset())}}document.addEventListener("DOMContentLoaded",(()=>{const t=new e(".modal",".offer__btn-form");new o(document.querySelector(".modal__form"),t)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c3QvLi9zcmMvU2VydmljZXMvRm9ybS9Gb3JtRXJyb3JzLmpzIiwid2VicGFjazovL3Rlc3QvLi9zcmMvU2VydmljZXMvRm9ybS9Gb3JtU2hvd01lc3NhZ2UuanMiLCJ3ZWJwYWNrOi8vdGVzdC8uL3NyYy9TZXJ2aWNlcy9Nb2RhbEZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vdGVzdC8uL3NyYy9TZXJ2aWNlcy9Gb3JtL0Zvcm1WYWxpZGF0aW9uLmpzIiwid2VicGFjazovL3Rlc3QvLi9zcmMvU2VydmljZXMvRm9ybS9Gb3JtLmpzIiwid2VicGFjazovL3Rlc3QvLi9zcmMvU2VydmljZXMvQXBpLmpzIiwid2VicGFjazovL3Rlc3QvLi9zcmMvanMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWwge1xyXG4gICAgY29uc3RydWN0b3IobW9kYWxTZWxlY3RvciwgdHJpZ2dlclNlbGVjdG9yID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMubW9kYWxTZWxlY3RvciA9IG1vZGFsU2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyU2VsZWN0b3IgPSB0cmlnZ2VyU2VsZWN0b3I7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdE1vZGFsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdE1vZGFsKCkge1xyXG4gICAgICAgIGNvbnN0IG1vZGFsID0gdGhpcy5nZXRNb2RhbCgpO1xyXG4gICAgICAgIGNvbnN0IG1vZGFsVHJpZ2dlciA9IHRoaXMudHJpZ2dlclNlbGVjdG9yID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnRyaWdnZXJTZWxlY3RvcikgOiBudWxsO1xyXG5cclxuICAgICAgICBpZiAoIW1vZGFsKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChtb2RhbFRyaWdnZXIpIHtcclxuICAgICAgICAgICAgbW9kYWxUcmlnZ2VyLmZvckVhY2goKGJ0bikgPT4ge1xyXG4gICAgICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5vcGVuTW9kYWwoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQgPT0gbW9kYWwgfHwgZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNsb3NlJykgPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VNb2RhbChtb2RhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUuY29kZSA9PT0gJ0VzY2FwZScgJiYgbW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VNb2RhbChtb2RhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIG9wZW5Nb2RhbCgpIHtcclxuICAgICAgICBjb25zdCBtb2RhbCA9IHRoaXMuZ2V0TW9kYWwoKTtcclxuXHJcbiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xyXG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcclxuXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgfVxyXG4gICAgY2xvc2VNb2RhbCgpIHtcclxuICAgICAgICBjb25zdCBtb2RhbCA9IHRoaXMuZ2V0TW9kYWwoKTtcclxuXHJcbiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xyXG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcclxuXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICcnO1xyXG4gICAgfVxyXG4gICAgZ2V0TW9kYWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5tb2RhbFNlbGVjdG9yKTtcclxuICAgIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtRXJyb3JzIHtcclxuICAgIGNvbnN0cnVjdG9yKGZvcm0pIHtcclxuICAgICAgICB0aGlzLmZvcm0gPSBmb3JtO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dFcnJvcihwcm9wZXJ0eSwgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCBjb250cm9sID0gdGhpcy5mb3JtLnF1ZXJ5U2VsZWN0b3IoYFtuYW1lPSR7cHJvcGVydHl9XWApO1xyXG4gICAgICAgIGNvbnN0IGVycm9yQm94ID0gRm9ybUVycm9ycy5nZXRFcnJvckJveChjb250cm9sKTtcclxuXHJcbiAgICAgICAgY29udHJvbC5jbGFzc0xpc3QuYWRkKCdmb3JtLWNvbnRyb2xfX2Vycm9yJyk7XHJcbiAgICAgICAgZXJyb3JCb3guaW5uZXJIVE1MID0gZXJyb3I7XHJcbiAgICAgICAgZXJyb3JCb3guY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFuRXJyb3IoY29udHJvbCkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yQm94ID0gRm9ybUVycm9ycy5nZXRFcnJvckJveChjb250cm9sKTtcclxuXHJcbiAgICAgICAgY29udHJvbC5jbGFzc0xpc3QucmVtb3ZlKCdmb3JtLWNvbnRyb2xfX2Vycm9yJyk7XHJcbiAgICAgICAgZXJyb3JCb3guY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xyXG5cclxuICAgICAgICBlcnJvckJveC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEVycm9yQm94KGNvbnRyb2wpIHtcclxuICAgICAgICByZXR1cm4gY29udHJvbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fZXJyb3ItbWVzc2FnZScpO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCBNb2RhbEZhY3RvcnkgZnJvbSAnLi4vTW9kYWxGYWN0b3J5JztcclxuaW1wb3J0IE1vZGFsIGZyb20gJy4uL01vZGFsJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1TaG93TWVzc2FnZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RhbEluc3RhbmNlID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMubW9kYWxJbnN0YW5jZSA9IG1vZGFsSW5zdGFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd1N1Y2Nlc3NNZXNzYWdlKCkge1xyXG4gICAgICAgIE1vZGFsRmFjdG9yeS5yZW5kZXJNb2RhbCgnPGRpdiBjbGFzcz1cIm1vZGFsX19mZWVkYmFjay10aXRsZVwiPllvdXIgbWVzc2FnZSBzdWNjZXNzZnVsbHkgc2VudDwvZGl2PicsICdtb2RhbFN1Y2Nlc3MnKTtcclxuICAgICAgICBjb25zdCBtb2RhbFN1Y2Nlc3MgPSBuZXcgTW9kYWwoJyNtb2RhbFN1Y2Nlc3MnKTtcclxuXHJcbiAgICAgICAgdGhpcy5tb2RhbEluc3RhbmNlLmNsb3NlTW9kYWwoKTtcclxuICAgICAgICBtb2RhbFN1Y2Nlc3Mub3Blbk1vZGFsKCk7XHJcbiAgICB9XHJcblxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsRmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgcmVuZGVyTW9kYWwodGVtcGxhdGUsIG1vZGFsSWQpIHtcclxuICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cclxuICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbCcpO1xyXG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcclxuICAgICAgICBtb2RhbC5pZCA9IG1vZGFsSWQ7XHJcbiAgICAgICAgbW9kYWwuaW5uZXJIVE1MID0gYFxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsX19kaWFsb2dcIj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtY2xvc2U9XCJcIiBjbGFzcz1cIm1vZGFsX19jbG9zZVwiPsOXPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgJHt0ZW1wbGF0ZX1cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIGA7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5hcHBlbmRDaGlsZChtb2RhbCk7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbDtcclxuICAgIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdGlvbiB7XHJcbiAgICBzdGF0aWMgcGF0dGVybk5hbWUgPSAvXlvQsC3Rj9GR0JAt0K/QgWEtekEtWlxcc10rJC87XHJcblx0c3RhdGljIHBhdHRlcm5NYWlsID0gL15bQS1aYS16MC05XSgoW19cXC5cXC1dP1thLXpBLVowLTldKykqKUAoW0EtWmEtejAtOV0rKSgoW1xcLlxcLV0/W2EtekEtWjAtOV0rKSopXFwuKFtBLVphLXpdKSskLztcclxuXHRzdGF0aWMgZXJyb3JNZXNzYWdlcyA9IFtcclxuXHRcdCdOYW1lIGNhbm5vdCBiZSBlbXB0eScsXHJcblx0XHQnRW1haWwgY2Fubm90IGJlIGVtcHR5JyxcclxuXHRcdCdJbmNvcnJlY3QgRW1haWwnLFxyXG5cdFx0J01lc3NhZ2UgY2Fubm90IGJlIGVtcHR5JyxcclxuXHRdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGZvcm0pIHtcclxuICAgICAgICB0aGlzLmZvcm0gPSBmb3JtO1xyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkRm9ybShmb3JtRGF0YSwgcHJvcGVydHkpIHtcclxuICAgICAgICBsZXQgZXJyb3IgPSAnJztcclxuXHJcbiAgICAgICAgY29uc3QgdmFsaWRhdGUgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChmb3JtRGF0YS5nZXQoJ25hbWUnKS5sZW5ndGggPT0gMCB8fCAhRm9ybVZhbGlkYXRpb24ucGF0dGVybk5hbWUudGVzdChmb3JtRGF0YS5nZXQoJ3VzZXJuYW1lJykpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBGb3JtVmFsaWRhdGlvbi5lcnJvck1lc3NhZ2VzWzBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlbWFpbDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1EYXRhLmdldCgnZW1haWwnKS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0gRm9ybVZhbGlkYXRpb24uZXJyb3JNZXNzYWdlc1sxXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIUZvcm1WYWxpZGF0aW9uLnBhdHRlcm5NYWlsLnRlc3QoZm9ybURhdGEuZ2V0KCdlbWFpbCcpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0gRm9ybVZhbGlkYXRpb24uZXJyb3JNZXNzYWdlc1syXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWVzc2FnZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1EYXRhLmdldCgnbWVzc2FnZScpLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBGb3JtVmFsaWRhdGlvbi5lcnJvck1lc3NhZ2VzWzNdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF2YWxpZGF0ZVtwcm9wZXJ0eV0pIHJldHVybiAnJztcclxuXHJcbiAgICAgICAgdmFsaWRhdGVbcHJvcGVydHldKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBlcnJvcjtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgQXBpIGZyb20gJy4uL0FwaSc7XHJcbmltcG9ydCBGb3JtRXJyb3JzIGZyb20gJy4vRm9ybUVycm9ycyc7XHJcbmltcG9ydCBGb3JtU2hvd01lc3NhZ2UgZnJvbSAnLi9Gb3JtU2hvd01lc3NhZ2UnO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRpb24gZnJvbSAnLi9Gb3JtVmFsaWRhdGlvbic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtIHtcclxuICAgIGNvbnN0cnVjdG9yKGZvcm0sIG1vZGFsSW5zdGFuY2UgPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtID0gZm9ybTsgLy8g0Y3Qu9C10LzQtdC90YIg0YTQvtGA0LzRi1xyXG5cdFx0dGhpcy5maWVsZHMgPSB0aGlzLmZvcm0ucXVlcnlTZWxlY3RvckFsbCgnLmZvcm0tY29udHJvbCcpOyAvLyDQutC+0LvQu9C10LrRhtC40Y8g0L/QvtC70LXQuSDRhNC+0YDQvNGLXHJcblx0XHR0aGlzLmJ0biA9IHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdbdHlwZT1zdWJtaXRdJyk7IC8vINC60L3QvtC/0LrQsCDQv9C+0LTRgtCy0LXRgNC20LTQtdC90LjRjyDRhNC+0YDQvNGLXHJcblx0XHR0aGlzLmlzRXJyb3IgPSBmYWxzZTsgLy8g0YTQu9Cw0LMg0LLQsNC70LjQtNCw0YbQuNC4XHJcbiAgICAgICAgdGhpcy51cmwgPSAnaHR0cHM6Ly9qc29ucGxhY2Vob2xkZXIudHlwaWNvZGUuY29tL3Bvc3RzJzsgLy8g0YHRgdGL0LvQutCwINC00LvRjyDQvtGC0L/RgNCw0LLQutC4INGE0L7RgNC80YtcclxuXHJcbiAgICAgICAgdGhpcy5lcnJvcnMgPSBuZXcgRm9ybUVycm9ycyhmb3JtKTsgLy8g0L7RiNC40LHQutC4XHJcbiAgICAgICAgdGhpcy52YWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0aW9uKGZvcm0pOyAvLyDQstCw0LvQuNC00LDRhtC40LhcclxuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gbmV3IEZvcm1TaG93TWVzc2FnZShtb2RhbEluc3RhbmNlKTsgLy8g0YHQvtC+0LHRidC10L3QuNGPXHJcblxyXG5cdFx0dGhpcy5yZWdpc3RlckV2ZW50c0hhbmRsZXIoKTsgLy8g0YDQtdCz0LjRgdGC0YDQsNGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQutC+0LIg0YHQvtCx0YvRgtC40LlcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3RlckV2ZW50c0hhbmRsZXIoKSB7XHJcbiAgICAgICAgdGhpcy5idG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnN1Ym1pdEZvcm0uYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIHRoaXMuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xyXG5cclxuICAgICAgICAgICAgaWYgKGVsID09PSB0aGlzLmJ0bikgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5lcnJvcnMuY2xlYW5FcnJvcihlbCk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgIH0sIHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHN1Ym1pdEZvcm0oZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEodGhpcy5mb3JtKTtcclxuICAgICAgICBsZXQgZXJyb3I7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHByb3BlcnR5IG9mIGZvcm1EYXRhLmtleXMoKSkge1xyXG4gICAgICAgICAgICBlcnJvciA9IHRoaXMudmFsaWRhdGlvbi52YWxpZEZvcm0oZm9ybURhdGEsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChlcnJvci5sZW5ndGggPT0gMCkgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlzRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmVycm9ycy5zaG93RXJyb3IocHJvcGVydHksIGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlzRXJyb3IpIHJldHVybjtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IE9iamVjdC5mcm9tRW50cmllcyhmb3JtRGF0YS5lbnRyaWVzKCkpO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQXBpLnJlcXVlc3QodGhpcy51cmwsICdQT1NUJywge30sIGRhdGEpO1xyXG5cclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnNob3dTdWNjZXNzTWVzc2FnZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZvcm0ucmVzZXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gICAgc3RhdGljIHJlcXVlc3QodXJsLCB0eXBlLCBoZWFkZXJzID0gbnVsbCwgZGF0YSA9IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdERhdGEgPSBkYXRhID8geyBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSB9IDoge31cclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcblxyXG4gICAgICAgICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogdHlwZS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIC4uLm9iamVjdERhdGFcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA+PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgMzAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IocmVzPy5zdGF0dXNUZXh0ID8/ICfQndC10LjQt9Cy0LXRgdGC0L3QsNGPINC+0YjQuNCx0LrQsCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLnJlc3BvbnNlID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIHRpbWU6IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0VGltZSkgLyAxMDAwXHJcbiAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvcj8ubWVzc2FnZSA/PyAn0J3QtdC40LfQstC10YHRgtC90LDRjyDQvtGI0LjQsdC60LAnLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogZXJyb3IucmVzcG9uc2U/LnN0YXR1cyA/PyA1MjBcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB0aW1lOiAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydFRpbWUpIC8gMTAwMFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgTW9kYWwgZnJvbSAnLi4vU2VydmljZXMvTW9kYWwnO1xuaW1wb3J0IEZvcm0gZnJvbSAnLi4vU2VydmljZXMvRm9ybS9Gb3JtJztcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgICBjb25zdCBGZWVkYmFja01vZGFsID0gbmV3IE1vZGFsKCcubW9kYWwnLCAnLm9mZmVyX19idG4tZm9ybScpOyAvLyDQvNC+0LTQsNC70YzQvdC+0LUg0L7QutC90L4g0L7QsdGA0LDRgtC90L7QuSDRgdCy0Y/Qt9C4XG4gICAgbmV3IEZvcm0oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19mb3JtJyksIEZlZWRiYWNrTW9kYWwpOyAvLyDRhNC+0YDQvNCwINC+0LHRgNCw0YLQvdC+0Lkg0YHQstGP0LfQuFxufSk7XG4iXSwibmFtZXMiOlsiTW9kYWwiLCJjb25zdHJ1Y3RvciIsIm1vZGFsU2VsZWN0b3IiLCJ0cmlnZ2VyU2VsZWN0b3IiLCJ0aGlzIiwiaW5pdE1vZGFsIiwibW9kYWwiLCJnZXRNb2RhbCIsIm1vZGFsVHJpZ2dlciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJidG4iLCJhZGRFdmVudExpc3RlbmVyIiwib3Blbk1vZGFsIiwiZSIsInRhcmdldCIsImdldEF0dHJpYnV0ZSIsImNsb3NlTW9kYWwiLCJjb2RlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJyZW1vdmUiLCJhZGQiLCJib2R5Iiwic3R5bGUiLCJvdmVyZmxvdyIsInF1ZXJ5U2VsZWN0b3IiLCJGb3JtRXJyb3JzIiwiZm9ybSIsInNob3dFcnJvciIsInByb3BlcnR5IiwiZXJyb3IiLCJjb250cm9sIiwiZXJyb3JCb3giLCJnZXRFcnJvckJveCIsImlubmVySFRNTCIsImNsZWFuRXJyb3IiLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwiRm9ybVNob3dNZXNzYWdlIiwibW9kYWxJbnN0YW5jZSIsInNob3dTdWNjZXNzTWVzc2FnZSIsInRlbXBsYXRlIiwibW9kYWxJZCIsImNyZWF0ZUVsZW1lbnQiLCJpZCIsImFwcGVuZENoaWxkIiwicmVuZGVyTW9kYWwiLCJtb2RhbFN1Y2Nlc3MiLCJGb3JtVmFsaWRhdGlvbiIsInZhbGlkRm9ybSIsImZvcm1EYXRhIiwidmFsaWRhdGUiLCJuYW1lIiwiZ2V0IiwibGVuZ3RoIiwicGF0dGVybk5hbWUiLCJ0ZXN0IiwiZXJyb3JNZXNzYWdlcyIsImVtYWlsIiwicGF0dGVybk1haWwiLCJtZXNzYWdlIiwiRm9ybSIsImZpZWxkcyIsImlzRXJyb3IiLCJ1cmwiLCJlcnJvcnMiLCJ2YWxpZGF0aW9uIiwibWVzc2FnZXMiLCJyZWdpc3RlckV2ZW50c0hhbmRsZXIiLCJzdWJtaXRGb3JtIiwiYmluZCIsImVsIiwiYWN0aXZlRWxlbWVudCIsInByZXZlbnREZWZhdWx0IiwiRm9ybURhdGEiLCJrZXlzIiwiZGF0YSIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwiZW50cmllcyIsInR5cGUiLCJoZWFkZXJzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJvYmplY3REYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsInN0YXJ0VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiZmV0Y2giLCJtZXRob2QiLCJ0b1VwcGVyQ2FzZSIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJFcnJvciIsInJlcyIsInN0YXR1c1RleHQiLCJzdWNjZXNzIiwidGltZSIsImNhdGNoIiwicmVxdWVzdCIsInJlc2V0IiwiRmVlZGJhY2tNb2RhbCJdLCJzb3VyY2VSb290IjoiIn0=